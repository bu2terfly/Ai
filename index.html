<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Attendance AI Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #22223b;
            --primary-color: #00bcd4; /* Cyan/Turquoise */
            --text-light: #e0e0e0;
            --text-muted: #9fa8da;
            --border-color: #3f3f5f;
            --success-color: #4CAF50;
            --danger-color: #FF5252;
        }

        /* --- Base & Typography --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-light);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .dashboard-container {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column; /* Stacked on mobile by default */
            gap: 20px;
        }

        /* --- Global Card Styling --- */
        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        /* --- Header & Sidebar --- */
        header h1 {
            font-size: 2.2em;
            font-weight: 900;
            margin: 0 0 5px 0;
            color: white;
            text-align: center;
        }
        header p {
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            order: 2; /* Sidebar moves below main content on mobile */
        }

        .data-section h2 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.3em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .data-point {
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .spi-placeholder {
            padding: 10px;
            background-color: #3f3f5f;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #ffc107; 
        }

        .subject-list {
            list-style: none;
            padding: 0;
        }

        .subject-list li {
            padding: 8px 0;
            border-bottom: 1px dotted var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        .subject-list li:last-child { border-bottom: none; }

        .percentage-value {
            font-weight: bold;
        }
        .low-att { color: var(--danger-color); }
        .safe-att { color: var(--success-color); }
        .borderline-att { color: #FFC107; }

        /* --- Main Content (Query & Response) --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            order: 1; /* Main content stays on top on mobile */
        }

        /* --- Input Section --- */
        #user-prompt {
            background-color: #3f3f5f;
            color: var(--text-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            font-size: 1em;
            margin-bottom: 15px;
            width: 100%;
            box-sizing: border-box;
        }

        .prompt-controls {
            display: flex;
            flex-direction: column; /* Stack controls on mobile */
            gap: 10px;
            align-items: stretch;
        }
        
        .prompt-controls span {
            text-align: center;
            font-size: 0.85em;
        }

        button {
            background-color: var(--primary-color);
            color: var(--card-bg);
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: background-color 0.2s, transform 0.1s;
        }

        /* --- Output Section --- */
        .output-section {
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        #response-output {
            flex-grow: 1;
            white-space: pre-wrap;
            background-color: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--border-color);
            font-family: monospace;
            line-height: 1.6;
            overflow-x: auto;
            color: var(--text-light);
            font-size: 0.95em;
        }

        /* --- Metrics Section --- */
        .metrics-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns on mobile */
            gap: 10px;
            margin-top: 15px;
        }

        .metric-item {
            background-color: #3f3f5f;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-item-value {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2px;
        }

        .metric-item-label {
            font-size: 0.7em;
            color: var(--text-muted);
        }

        .disclaimer {
            margin-top: 15px;
            font-size: 0.75em;
            color: var(--text-muted);
            text-align: center;
        }

        /* --- Desktop View (Min-width: 768px) --- */
        @media (min-width: 768px) {
            .dashboard-container {
                flex-direction: row;
                display: grid;
                grid-template-columns: 350px 1fr; /* Switch to 2-column layout */
                gap: 30px;
            }

            .sidebar {
                order: 1; /* Sidebar goes back to the left */
            }

            .main-content {
                order: 2; /* Main content goes back to the right */
            }

            .metrics-section {
                grid-template-columns: repeat(4, 1fr); /* 4 columns on desktop */
            }
            
            .prompt-controls {
                flex-direction: row; /* Controls back in a row */
                justify-content: space-between;
                align-items: center;
            }
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        
        <div class="main-content">
            <header>
                <h1>Attendance AI ‚ö°</h1>
                <p>Testing Gemini for personalized college attendance analysis.</p>
            </header>

            <div class="input-section card">
                <h2>üí¨ Ask Your AI</h2>
                <input type="text" id="user-prompt" placeholder="E.g., Can I skip all classes for next 2 days?" value="If I skip 3 days then attend 2 days next what will be my percentage?" required>
                
                <div class="prompt-controls">
                    <span style="color: var(--text-muted);">Model: **gemini-2.5-flash**</span>
                    <button id="send-button" onclick="sendPrompt()">Get Analysis</button>
                </div>
            </div>

            <div class="output-section card">
                <h2>üß† AI Response</h2>
                <pre id="response-output">
                    The AI analysis will appear here. The response will be friendly, concise, and point-to-point.
                </pre>
            </div>
        </div>
        
        <div class="sidebar">

            <div class="data-section card">
                <h2>Current Data Status</h2>
                <div id="attendance-data-display">
                    </div>
                <div class="spi-placeholder">
                    üìà **SPI Placeholder:** (8.4/10.0) - Add your Semester Performance Index here!
                </div>
            </div>

            <div class="data-section card">
                <h2>‚öôÔ∏è API Metrics</h2>
                <div class="metrics-section">
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-rpd">--</div>
                        <div class="metric-item-label">RPD (sec)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-cost">$0.00</div>
                        <div class="metric-item-label">Cost (USD)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-tokens-in">0</div>
                        <div class="metric-item-label">Tokens In</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-tokens-out">0</div>
                        <div class="metric-item-label">Tokens Out</div>
                    </div>
                </div>
                <p class="disclaimer">Note: Metrics are frontend estimates; use a secure backend for production tracking.</p>
            </div>
        </div>

    </div>

    <script>
        // ‚ö†Ô∏è WARNING: API Key is exposed in client-side code. Use a backend for production.
        const GEMINI_API_KEY = "AIzaSyDOfQo4rmPDMRtcOXpKLJ6u5vtYmRxS0Ew"; // Your Key Inserted Here
        const GEMINI_MODEL = "gemini-2.5-flash"; 

        // 1. SIMULATED FIREBASE DATA (Your input data structure)
        const attendanceData = {
            totalCollegeDays: 34,
            totalClassesPerDay: "3-4", 
            subjectAttendance: {
                "Ca": { attended: 5, total: 8 },
                "Fm": { attended: 23, total: 27 },
                "Geo": { attended: 31, total: 34 },
                "Bio": { attended: 9, total: 15 },
                "Ast": { attended: 16, total: 24 },
                "Ut": { attended: 8, total: 10 }
            }
        };

        // --- Utility Functions ---

        function getPercentageClass(percentage) {
            if (percentage < 60) return 'low-att';
            if (percentage < 75) return 'borderline-att';
            return 'safe-att';
        }

        function displayData() {
            const displayDiv = document.getElementById('attendance-data-display');
            let html = `<div class="data-point"><strong>Total College Days:</strong> <span>${attendanceData.totalCollegeDays}</span></div>`;
            html += `<div class="data-point"><strong>Classes/Day:</strong> <span>${attendanceData.totalClassesPerDay}</span></div>`;
            html += `<h3>Subject Attendance:</h3><ul class="subject-list">`;
            
            for (const [subject, data] of Object.entries(attendanceData.subjectAttendance)) {
                const percentage = ((data.attended / data.total) * 100);
                const percentageClass = getPercentageClass(percentage);

                html += `<li>`;
                html += `<span>${subject}: ${data.attended}/${data.total}</span>`;
                html += `<span class="percentage-value ${percentageClass}">${percentage.toFixed(2)}%</span>`;
                html += `</li>`;
            }
            html += `</ul>`;
            displayDiv.innerHTML = html;
        }
        
        function createDataPrompt() {
            let dataString = `
                Current Attendance Performance:
                - Total College Days passed: ${attendanceData.totalCollegeDays}
                - Classes per day: ${attendanceData.totalClassesPerDay} (Use an average of 3.5 classes/day for general calculations, but subject-wise data is primary)
                - Subject-wise Attendance (Attended/Total - Percentage):
            `;

            for (const [subject, data] of Object.entries(attendanceData.subjectAttendance)) {
                const percentage = ((data.attended / data.total) * 100).toFixed(2);
                dataString += `\n  - ${subject}: ${data.attended}/${data.total} (${percentage}%)`;
            }
            return dataString;
        }

        function updateMetrics(rpd, cost, tokensIn, tokensOut) {
            document.getElementById('metric-rpd').innerText = rpd !== null ? `${rpd.toFixed(2)}s` : '--';
            document.getElementById('metric-cost').innerText = cost !== null ? `$${cost.toFixed(4)}` : '$0.00';
            document.getElementById('metric-tokens-in').innerText = tokensIn !== null ? tokensIn : 0;
            document.getElementById('metric-tokens-out').innerText = tokensOut !== null ? tokensOut : 0;
        }

        // 2. MAIN FUNCTION TO CALL THE GEMINI API
        async function sendPrompt() {
            const userPrompt = document.getElementById('user-prompt').value;
            const outputDiv = document.getElementById('response-output');
            const sendButton = document.getElementById('send-button');
            const startTime = Date.now();
            
            if (!userPrompt) {
                outputDiv.innerText = "üö® Error: Please enter a question.";
                return;
            }

            outputDiv.innerText = "üß† Analyzing your request... (Status: Waiting for AI)";
            sendButton.disabled = true;
            sendButton.innerText = "Analyzing...";
            
            const dataPrompt = createDataPrompt();

            // Constructed prompt: Structured for Completeness and Concise Output
            const fullPrompt = `
                You are a concise, friendly, and factual Attendance Best Friend AI. Your response must be:
                1. Start with a brief, encouraging opener (max one sentence).
                2. Use clear headings and bullet points for all results.
                3. **CRITICAL INSTRUCTION**: Provide a detailed calculation summary for the scenario below for **EACH** subject listed in the data.

                ---
                STUDENT'S CURRENT ATTENDANCE DATA:
                ${dataPrompt}
                ---

                STUDENT'S QUESTION:
                "${userPrompt}"
                ---

                ### SCENARIO CALCULATION RULES:
                The scenario involves 3 missed days and 2 attended days. Use an average of 3.5 classes per day for this projection:
                - **Total Missed Classes:** 3 days * 3.5 classes/day = 10.5 classes
                - **Total Attended Classes:** 2 days * 3.5 classes/day = 7 classes

                **Perform the full calculation for each subject:**
                New Attended = Current Attended + 7
                New Total = Current Total + 10.5 (missed) + 7 (attended) = Current Total + 17.5
                New Percentage = (New Attended / New Total) * 100

                Output the result clearly.
            `;
            
            let tokensIn = fullPrompt.length; 

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: fullPrompt }]
                        }],
                        generationConfig: {
                            temperature: 0.1, 
                            maxOutputTokens: 1024 
                        }
                    })
                });

                const result = await response.json();
                const endTime = Date.now();
                const rpd = (endTime - startTime) / 1000;
                let tokensOut = 0;
                let aiText = "Could not get a valid response from the AI.";

                if (result.error) {
                    aiText = `üö® API ERROR: ${result.error.message}`;
                    console.error("API Error:", result.error);
                } else if (result.candidates && result.candidates.length > 0) {
                    aiText = result.candidates[0].content.parts[0].text;
                    if (result.usageMetadata) {
                         tokensIn = result.usageMetadata.promptTokenCount || tokensIn;
                         tokensOut = result.usageMetadata.candidatesTokenCount || 0;
                    }
                }

                outputDiv.innerText = aiText;
                
                const estimatedCost = (tokensIn + tokensOut) * (0.00035 / 1000); 
                updateMetrics(rpd, estimatedCost, tokensIn, tokensOut);

            } catch (error) {
                outputDiv.innerText = `‚ö†Ô∏è An unexpected network error occurred: ${error.message}`;
                console.error("Fetch Error:", error);
                const rpd = (Date.now() - startTime) / 1000;
                updateMetrics(rpd, 0, tokensIn, 0);
            } finally {
                sendButton.disabled = false;
                sendButton.innerText = "Get Analysis";
            }
        }

        // Initialize the page display
        window.onload = displayData;
    </script>

</body>
</html>
