<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Campus AI • College Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { margin:0; font-family:system-ui; background:#343541; color:#fff }
    .app { display:flex; height:100vh }
    .sidebar { width:260px; background:#202123; padding:10px }
    .main { flex:1; display:flex; flex-direction:column }
    .header { padding:12px; border-bottom:1px solid #444 }
    .chat { flex:1; overflow-y:auto; padding:12px }
    .msg { padding:10px; margin-bottom:10px; border-radius:8px }
    .user { background:#2f80ed }
    .bot { background:#444654 }
    .input { display:flex; padding:10px; border-top:1px solid #444 }
    textarea { flex:1; background:#40414f; color:#fff; border:none; padding:10px; border-radius:8px }
    button { margin-left:6px; padding:10px 14px; background:#10a37f; border:none; color:#fff; border-radius:8px }
    .info { font-size:13px; opacity:0.8; margin-top:6px }
  </style>
</head>
<body>

<div class="app">
  <div class="sidebar">
    <h3>Student Info</h3>
    <div class="info">
      Name: Rohan Sharma <br>
      ID: CS23-041 <br>
      Class: B.Com (Hons) Sem-3 <br>
      Attendance: 86% Overall
    </div>

    <h3 style="margin-top:15px">College</h3>
    <div class="info">
      North Hills Commerce College <br>
      Principal: Dr. Priya Mukherjee <br>
      HoD: Prof. S. K. Dutta
    </div>
  </div>

  <div class="main">
    <div class="header">Campus AI – College Academic Assistant</div>
    <div class="chat" id="chat"></div>

    <div class="input">
      <textarea id="input" placeholder="Ask about attendance, college, HoD, exams, micro finance..."></textarea>
      <button onclick="send()">Send</button>
    </div>
  </div>
</div>

<script>
/* ===================== CONFIG ===================== */
const GEMINI_API_KEY = "AIzaSyDOfQo4rmPDMRtcOXpKLJ6u5vtYmRxS0Ew";

/* ===================== DOMAIN GATE ===================== */
function isAllowed(q) {
  q = q.toLowerCase();

  const blocked = ["stock", "share", "crypto", "bitcoin", "trading", "cv", "resume", "job", "investment", "news", "politics"];
  for (let b of blocked) if (q.includes(b)) return false;

  const allowed = ["attendance","college","principal","hod","exam","leave","micro","finance","mfi","shg","jlg","bcom","rohan"];
  for (let a of allowed) if (q.includes(a)) return true;

  return false;
}

/* ===================== UI ===================== */
const chat = document.getElementById("chat");
const input = document.getElementById("input");

function add(text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===================== PROMPT ===================== */
function buildPrompt(userQ) {
return `
You are Campus AI for North Hills Commerce College.

Student:
Rohan Sharma (B.Com Hons, Sem 3)
Attendance:
Micro Finance 92%
Business Law 80%
QT 82%
Overall 86%

College:
Principal: Dr. Priya Mukherjee
HoD: Prof. S. K. Dutta

Rules:
Minimum 75% attendance required.

Scope:
✅ Attendance, college info, principal, HoD
✅ Leave applications to HoD/Principal
✅ Commerce & Micro Finance only
❌ Stock tips, crypto, jobs, CVs, other colleges

Style:
Point-to-point, short, human-like.

Question:
${userQ}
`;
}

/* ===================== GEMINI CALL ===================== */
async function callAI(q) {
  const res = await fetch(
    "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=" + GEMINI_API_KEY,
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: buildPrompt(q) }] }]
      })
    }
  );

  const data = await res.json();
  return data.candidates[0].content.parts[0].text;
}

/* ===================== SEND FUNCTION ===================== */
async function send() {
  const q = input.value.trim();
  if (!q) return;
  input.value = "";

  add(q, "user");

  if (!isAllowed(q)) {
    add("I am only designed for our college, attendance & micro finance study. Other topics are not allowed here.", "bot");
    return;
  }

  add("Thinking...", "bot");

  try {
    const reply = await callAI(q);
    chat.lastChild.innerText = reply;
  } catch {
    chat.lastChild.innerText = "Connection error. Check API key or internet.";
  }
}
</script>

</body>
</html>
