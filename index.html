<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Attendance AI Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #22223b;
            --primary-color: #00bcd4; /* Cyan/Turquoise */
            --text-light: #e0e0e0;
            --text-muted: #9fa8da;
            --border-color: #3f3f5f;
            --success-color: #4CAF50;
            --danger-color: #FF5252;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-light);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .dashboard-container {
            width: 100%;
            max-width: 1100px;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
        }

        /* --- Global Card Styling --- */
        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        /* --- Sidebar (Attendance Data) --- */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .data-section h2 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.5em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .data-point {
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .data-point strong {
            color: var(--text-light);
            font-weight: 600;
        }

        .data-point span {
            color: var(--text-muted);
        }

        .subject-list {
            list-style: none;
            padding: 0;
        }

        .subject-list li {
            padding: 8px 0;
            border-bottom: 1px dotted var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        .subject-list li:last-child { border-bottom: none; }

        .percentage-value {
            font-weight: bold;
        }
        .low-att { color: var(--danger-color); }
        .safe-att { color: var(--success-color); }
        .borderline-att { color: #FFC107; }

        /* --- Main Content (Query & Response) --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        header h1 {
            font-size: 2.5em;
            font-weight: 900;
            margin: 0 0 10px 0;
            color: white;
        }

        /* --- Input Section --- */
        .input-section {
            display: flex;
            flex-direction: column;
        }

        #user-prompt {
            background-color: #3f3f5f;
            color: var(--text-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            font-size: 1em;
            margin-bottom: 15px;
            width: calc(100% - 30px);
            box-sizing: border-box;
        }

        .prompt-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            background-color: var(--primary-color);
            color: var(--card-bg);
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 700;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover { background-color: #00a4b9; }
        button:active { transform: scale(0.98); }
        button:disabled { background-color: #555; cursor: not-allowed; }

        /* --- Output Section --- */
        .output-section {
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        #response-output {
            flex-grow: 1;
            white-space: pre-wrap;
            background-color: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--border-color);
            font-family: monospace;
            line-height: 1.6;
            overflow-x: auto;
            color: var(--text-light);
        }

        /* --- Metrics Section --- */
        .metrics-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .metric-item {
            background-color: #3f3f5f;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-item-value {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .metric-item-label {
            font-size: 0.8em;
            color: var(--text-muted);
        }

        .disclaimer {
            margin-top: 15px;
            font-size: 0.75em;
            color: var(--text-muted);
            text-align: center;
        }

    </style>
</head>
<body>

    <div class="dashboard-container">
        
        <div class="sidebar">
            <header>
                <h1>Attendance AI ‚ö°</h1>
                <p style="color: var(--text-muted);">Testing Gemini for college attendance predictions.</p>
            </header>

            <div class="data-section card">
                <h2>Current Data Status</h2>
                <div id="attendance-data-display">
                    </div>
            </div>

            <div class="data-section card">
                <h2>‚öôÔ∏è API Metrics (Estimate)</h2>
                <div class="metrics-section">
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-rpd">~0.5s</div>
                        <div class="metric-item-label">RPD (sec)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-cost">$0.00</div>
                        <div class="metric-item-label">Cost (USD)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-tokens-in">0</div>
                        <div class="metric-item-label">Tokens In</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-item-value" id="metric-tokens-out">0</div>
                        <div class="metric-item-label">Tokens Out</div>
                    </div>
                </div>
                <p class="disclaimer">Note: RPD/Cost/Tokens are simulated/placeholder on the frontend. Use a backend for real data.</p>
            </div>
        </div>

        <div class="main-content">
            
            <div class="input-section card">
                <h2>üí¨ Ask Your AI</h2>
                <input type="text" id="user-prompt" placeholder="E.g., Can I skip all classes for next 2 days?" value="If I skip 3 days then attend 2 days next what will be my percentage?" required>
                
                <div class="prompt-controls">
                    <span style="color: var(--text-muted); font-size: 0.9em;">Model: **gemini-2.5-flash**</span>
                    <button id="send-button" onclick="sendPrompt()">Get Analysis</button>
                </div>
            </div>

            <div class="output-section card">
                <h2>üß† AI Response</h2>
                <pre id="response-output">
                    The AI analysis will appear here. The style is now *friendly, concise, and point-to-point*, focusing only on the calculation results and advice.
                </pre>
            </div>
            
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è WARNING: API Key is exposed in client-side code. Use a backend for production.
        const GEMINI_API_KEY = "AIzaSyBqgrroGtY9YNz5TwrG0Tj6OHaAGVhAEGU"; // <<< REPLACE WITH YOUR KEY
        const GEMINI_MODEL = "gemini-2.5-flash"; 

        // 1. SIMULATED FIREBASE DATA (Your input data structure)
        const attendanceData = {
            totalCollegeDays: 34,
            totalClassesPerDay: "3-4", 
            subjectAttendance: {
                "Ca": { attended: 5, total: 8 },
                "Fm": { attended: 23, total: 27 },
                "Geo": { attended: 31, total: 34 },
                "Bio": { attended: 9, total: 15 },
                "Ast": { attended: 16, total: 24 },
                "Ut": { attended: 8, total: 10 }
            }
        };

        // --- Utility Functions ---

        function getPercentageClass(percentage) {
            if (percentage < 60) return 'low-att';
            if (percentage < 75) return 'borderline-att';
            return 'safe-att';
        }

        // Function to display the data on the page
        function displayData() {
            const displayDiv = document.getElementById('attendance-data-display');
            let html = `<div class="data-point"><strong>Total College Days:</strong> <span>${attendanceData.totalCollegeDays}</span></div>`;
            html += `<div class="data-point"><strong>Classes/Day:</strong> <span>${attendanceData.totalClassesPerDay}</span></div>`;
            html += `<h3>Subject Attendance:</h3><ul class="subject-list">`;
            
            for (const [subject, data] of Object.entries(attendanceData.subjectAttendance)) {
                const percentage = ((data.attended / data.total) * 100);
                const percentageClass = getPercentageClass(percentage);

                html += `<li>`;
                html += `<span>${subject}: ${data.attended}/${data.total}</span>`;
                html += `<span class="percentage-value ${percentageClass}">${percentage.toFixed(2)}%</span>`;
                html += `</li>`;
            }
            html += `</ul>`;
            displayDiv.innerHTML = html;
        }
        
        // Function to convert the data into a clear, parsable string for the AI
        function createDataPrompt() {
            let dataString = `
                Current Attendance Performance:
                - Total College Days passed: ${attendanceData.totalCollegeDays}
                - Classes per day: ${attendanceData.totalClassesPerDay} (Use an average of 3.5 classes/day for general calculations, but subject-wise data is primary)
                - Subject-wise Attendance (Attended/Total - Percentage):
            `;

            for (const [subject, data] of Object.entries(attendanceData.subjectAttendance)) {
                const percentage = ((data.attended / data.total) * 100).toFixed(2);
                dataString += `\n  - ${subject}: ${data.attended}/${data.total} (${percentage}%)`;
            }
            return dataString;
        }

        // Function to update metric display
        function updateMetrics(rpd, cost, tokensIn, tokensOut) {
            document.getElementById('metric-rpd').innerText = rpd !== null ? `${rpd.toFixed(2)}s` : '--';
            document.getElementById('metric-cost').innerText = cost !== null ? `$${cost.toFixed(4)}` : '$0.00';
            document.getElementById('metric-tokens-in').innerText = tokensIn !== null ? tokensIn : 0;
            document.getElementById('metric-tokens-out').innerText = tokensOut !== null ? tokensOut : 0;
        }

        // 2. MAIN FUNCTION TO CALL THE GEMINI API
        async function sendPrompt() {
            const userPrompt = document.getElementById('user-prompt').value;
            const outputDiv = document.getElementById('response-output');
            const sendButton = document.getElementById('send-button');
            const startTime = Date.now();
            
            if (!userPrompt || GEMINI_API_KEY === "YOUR_API_KEY_HERE") {
                outputDiv.innerText = "üö® Error: Please enter a question and/or replace 'YOUR_API_KEY_HERE' in the script.";
                return;
            }

            outputDiv.innerText = "üß† Analyzing your request... (Status: Waiting for AI)";
            sendButton.disabled = true;
            sendButton.innerText = "Analyzing...";
            
            const dataPrompt = createDataPrompt();

            // Constructing the complete prompt for the AI - **Friendly, concise, and point-to-point style enforced here**
            const fullPrompt = `
                You are a concise, friendly, and factual Attendance Best Friend AI. Your response must be:
                1. Point-to-point (using bullet points or clear headings).
                2. Short, human-like, and easy to understand.
                3. Strictly focused on the calculation results and clear advice based on the numbers.
                4. **Crucially**: Answer the student's question by performing the calculation for EACH subject using the current data.

                ---
                STUDENT'S CURRENT ATTENDANCE DATA:
                ${dataPrompt}
                ---

                STUDENT'S QUESTION:
                "${userPrompt}"
                ---

                Analyze the scenario: The student skips for 3 days and then attends for 2 days. Assume the average of 3.5 classes per day are skipped/attended across ALL subjects for the scenario calculation unless specific subject totals are relevant. Provide the new projected attendance for each subject.
            `;
            
            let tokensIn = fullPrompt.length; // Simple placeholder approximation

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: fullPrompt }]
                        }],
                        // Request a shorter, point-to-point response
                        config: {
                            temperature: 0.1, 
                            maxOutputTokens: 500
                        }
                    })
                });

                const result = await response.json();
                const endTime = Date.now();
                const rpd = (endTime - startTime) / 1000;
                let tokensOut = 0;
                let aiText = "Could not get a valid response from the AI.";

                if (result.error) {
                    aiText = `üö® API ERROR: ${result.error.message}`;
                    console.error("API Error:", result.error);
                } else if (result.candidates && result.candidates.length > 0) {
                    aiText = result.candidates[0].content.parts[0].text;
                    // Attempt to get actual token count (if available in your specific setup)
                    if (result.usageMetadata) {
                         tokensIn = result.usageMetadata.promptTokenCount || tokensIn;
                         tokensOut = result.usageMetadata.candidatesTokenCount || 0;
                    }
                }

                outputDiv.innerText = aiText;
                
                // Update Metrics (Cost is a placeholder calculation, needs backend for accuracy)
                // Assuming rough estimate: 0.00035 USD / 1000 tokens for flash
                const estimatedCost = (tokensIn + tokensOut) * (0.00035 / 1000); 
                updateMetrics(rpd, estimatedCost, tokensIn, tokensOut);

            } catch (error) {
                outputDiv.innerText = `‚ö†Ô∏è An unexpected network error occurred: ${error.message}`;
                console.error("Fetch Error:", error);
                const rpd = (Date.now() - startTime) / 1000;
                updateMetrics(rpd, 0, tokensIn, 0); // Update RPD on error
            } finally {
                sendButton.disabled = false;
                sendButton.innerText = "Get Analysis";
            }
        }

        // Initialize the page display
        window.onload = displayData;
    </script>

</body>
</html>
